{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/frontend/src/middleware.ts"],"sourcesContent":["import { withAuth } from \"next-auth/middleware\";\r\nimport { NextResponse } from \"next/server\";\r\n\r\nexport default withAuth(\r\n  function middleware(request) {\r\n    const { nextUrl } = request;\r\n    const token = request.nextauth.token;\r\n    const userRole = token?.role as string;\r\n\r\n    const isOnDashboard = nextUrl.pathname.startsWith(\"/dashboard\");\r\n    const isOnAdmin = nextUrl.pathname.startsWith(\"/admin\");\r\n    const isOnLogin = nextUrl.pathname.startsWith(\"/login\");\r\n\r\n    if (isOnLogin && token) {\r\n      return NextResponse.redirect(new URL(\"/dashboard\", nextUrl));\r\n    }\r\n\r\n    if (isOnAdmin && userRole !== \"admin\") {\r\n      return NextResponse.redirect(new URL(\"/unauthorized\", nextUrl));\r\n    }\r\n\r\n    return NextResponse.next();\r\n  },\r\n  {\r\n    callbacks: {\r\n      authorized: ({ token, req }) => {\r\n        const { pathname } = req.nextUrl;\r\n\r\n        // Public routes (no token required)\r\n        if (\r\n          pathname.startsWith(\"/login\") ||\r\n          pathname === \"/\" ||\r\n          pathname.startsWith(\"/api/auth\") // Important: allow NextAuth API routes\r\n        ) {\r\n          return true;\r\n        }\r\n\r\n        // Protected routes require token\r\n        if (\r\n          pathname.startsWith(\"/dashboard\") ||\r\n          pathname.startsWith(\"/admin\") ||\r\n          pathname.startsWith(\"/profile\") ||\r\n          pathname.startsWith(\"/settings\")\r\n        ) {\r\n          return !!token; // Must have valid token\r\n        }\r\n\r\n        // Default: allow\r\n        return true;\r\n      },\r\n    },\r\n    pages: {\r\n      signIn: \"/login\",\r\n    },\r\n  }\r\n);\r\n\r\nexport const config = {\r\n  matcher: [\r\n    \"/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)\",\r\n  ],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;;;uCAEe,IAAA,0KAAQ,EACrB,SAAS,WAAW,OAAO;IACzB,MAAM,EAAE,OAAO,EAAE,GAAG;IACpB,MAAM,QAAQ,QAAQ,QAAQ,CAAC,KAAK;IACpC,MAAM,WAAW,OAAO;IAExB,MAAM,gBAAgB,QAAQ,QAAQ,CAAC,UAAU,CAAC;IAClD,MAAM,YAAY,QAAQ,QAAQ,CAAC,UAAU,CAAC;IAC9C,MAAM,YAAY,QAAQ,QAAQ,CAAC,UAAU,CAAC;IAE9C,IAAI,aAAa,OAAO;QACtB,OAAO,4MAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc;IACrD;IAEA,IAAI,aAAa,aAAa,SAAS;QACrC,OAAO,4MAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,iBAAiB;IACxD;IAEA,OAAO,4MAAY,CAAC,IAAI;AAC1B,GACA;IACE,WAAW;QACT,YAAY,CAAC,EAAE,KAAK,EAAE,GAAG,EAAE;YACzB,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,OAAO;YAEhC,oCAAoC;YACpC,IACE,SAAS,UAAU,CAAC,aACpB,aAAa,OACb,SAAS,UAAU,CAAC,aAAa,uCAAuC;cACxE;gBACA,OAAO;YACT;YAEA,iCAAiC;YACjC,IACE,SAAS,UAAU,CAAC,iBACpB,SAAS,UAAU,CAAC,aACpB,SAAS,UAAU,CAAC,eACpB,SAAS,UAAU,CAAC,cACpB;gBACA,OAAO,CAAC,CAAC,OAAO,wBAAwB;YAC1C;YAEA,iBAAiB;YACjB,OAAO;QACT;IACF;IACA,OAAO;QACL,QAAQ;IACV;AACF;AAGK,MAAM,SAAS;IACpB,SAAS;QACP;KACD;AACH"}}]
}